<% layout("layouts/boilerplate") %>

<div class="row justify-content-center mt-4">
  <div class="col-md-7">

    <h2 class="mb-3"><%= listing.title %></h2>

    <div class="card border-0 shadow-sm p-3">

      <img src="<%= listing.image %>" class="img-fluid rounded mb-3 listing-show-img">

      

      <p class="text-muted"><%= listing.description %></p>

      <h6>₹ <%= listing.price.toLocaleString("en-IN") %></h6>

      <p class="mb-1"><strong><%= listing.location %></strong></p>
      <p class="text-muted"><%= listing.country %></p>

      <div class="mt-3">
        <a href="/listings/<%= listing._id %>/edit" class="btn btn-danger mr-2">Edit</a>

        <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE" class="d-inline">
          <button class="btn btn-dark">Delete</button>
        </form>
      </div>

    </div>

  </div>
</div>

<div>
  <hr/>
  <div>
  <hr/>
  <h3>Leave a Review</h3>

  <form method="post" 
        action="/listings/<%= listing._id %>/reviews" 
        class="needs-validation" 
        novalidate>

    <div class="mb-3 mt-3">
      <label for="rating" class="form-label">Rating</label>
      <input type="range" min="1" max="5" id="rating" name="review[rating]" class="form-range" required>
    </div>

    <div class="mb-3 mt-3">
      <label for="comment" class="form-label">Comment</label>

      <textarea 
        class="form-control" 
        id="comment" 
        name="review[comment]" 
        rows="3"  
        required ></textarea>

      <div class="invalid-feedback">
        Please provide a comment.
      </div>
    </div>

    <button class="btn btn-dark">Submit</button>
  </form>

<hr>

<h3 class="mb-3">All Reviews</h3>

<% if (listing.reviews.length === 0) { %>
  <p class="text-muted">No reviews yet. Be the first to review!</p>
<% } %>

<div class="row">
  <% for (let review of listing.reviews) { %>
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm border-0 review-card p-3">

        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="badge badge-dark px-3 py-2">
            <%= review.rating %> ⭐
          </span>
          <small class="text-muted">
            <%= new Date(review.createdAt).toLocaleDateString() %>
          </small>
        </div>

        <p class="mb-2"><%= review.comment %></p>

        <form method="POST" 
              action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
              class="text-right">
          
          <button class="btn btn-outline-danger btn-sm delete-btn">
            <i class="fa-solid fa-trash"></i> Delete
          </button>
        </form>

      </div>
    </div>
  <% } %>
</div>
